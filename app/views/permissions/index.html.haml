%h1= "#{@project.name} - Permissions"

%p
  You can
  =link_to 'edit default access levels', additional_permissions_project_path(@project)
  for this project. Currently, anonymous users have
  = AccessLevel.level_anonymous(@project)
  permissions and logged in users have
  = AccessLevel.level_logged_in(@project)
  permissions.

%p
  Project Owners:
  - owners = AccessLevel.users(@project, :owner)
  - owners.each do |permission|
    = link_to(permission.user.user_name, user_account_path(permission.user))
    = ',' unless permission == owners.last

%p
  Project Writers:
  - writers = AccessLevel.users(@project, :writer)
  - AccessLevel.users(@project, :writer).each do |permission|
    = link_to(permission.user.user_name, user_account_path(permission.user))
    = ',' unless permission == writers.last

  %p
  Project Readers:
  - readers = AccessLevel.users(@project, :reader)
  - AccessLevel.users(@project, :reader).each do |permission|
    = link_to(permission.user.user_name, user_account_path(permission.user))
    = ',' unless permission == readers.last

%hr

= simple_form_for :permission, url: update_permissions_project_path(@project) do |p|
  - project_logged_in = AccessLevel.level_logged_in(@project)
  - project_anon = AccessLevel.level_logged_in(@project)
  %table.table.table-striped
    %thead
      %tr
        %th User
        %th No Access
        %th Read
        %th Read & Write
        %th Owner
    %tbody
    - User.users.includes(:permissions).order('lower(user_name) ASC').each do |user|
      - user_level = AccessLevel.manual_level(user, @project, project_anon, project_logged_in)
      - a= 1
      %tr{user_id: user.id}
        %td= link_to user.user_name, user_account_path(user)
        %td
          %input{id: "user_#{user.id}_permissions_level_none",
                    type: 'radio',
                    name: "[user_ids][#{user.id}][permissions][level]",
                    value: '',
                    checked: :none == user_level}
        %td
          %input{id: "user_#{user.id}_permissions_level_reader",
                    type: 'radio',
                    name: "[user_ids][#{user.id}][permissions][level]",
                    value: 'reader',
                    checked: :reader == user_level}

        %td
          %input{id: "user_#{user.id}_permissions_level_writer",
                    type: 'radio',
                    name: "[user_ids][#{user.id}][permissions][level]",
                    value: 'writer',
                    checked: :writer == user_level}
        %td
          %input{id: "user_#{user.id}_permissions_level_owner",
                    type: 'radio',
                    name: "[user_ids][#{user.id}][permissions][level]",
                    value: 'owner',
                    checked: :owner == user_level}
  .form-actions
    = p.submit 'Update Permissions', class: 'btn'

- content_for :title, "Permissions for Project #{@project.name}"

-#- content_for :left_sidebar do
-#  = render layout: '/shared/left_sidebar', locals: {title: 'Projects'} do
-#    %li= link_to 'Project', project_path(@project),  title: "Back to project view", data: {toggle: 'tooltip',  placement: 'right'}

